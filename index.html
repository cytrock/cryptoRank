<!DOCTYPE html>
<html lang="en">
<div id="language-select-container">
    <label for="language-select">Choose a language:</label>
    <select id="language-select" onchange="location = this.value;">
        <option value="/en/index.html">English</option>
        <option value="/zh/index.html">中文</option>
        <option value="/es/index.html">Español</option>
        <option value="/fr/index.html">Français</option>
        <option value="/de/index.html">Deutsch</option>
        <option value="/ja/index.html">日本語</option>
        <option value="/ko/index.html">한국어</option>
        <option value="/ru/index.html">Русский</option>
    </select>
    <br>
    <a href="usdt.jpg">buy me a coffee</a>
</div>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Cryptocurrency Volume Rankings</title>
	<link rel="stylesheet" href="css/common.css" />
</head>
<body>
    <div id="app">
        <h1 align="center">Cryptocurrency Volume Rankings</h1>
        <table id="currencies-table">
            <thead>
                <tr>
                    <th>CoinName</th>
                    <th id="th-price" style="cursor:pointer">Current Price</th>
                    <th id="th-change" style="cursor:pointer">24h Change</th>
                    <th id="th-volume" style="cursor:pointer">24h Volume</th>
                    <th id="th-marketcap" style="cursor:pointer">Market Cap</th>
                    <th id="th-ratio" style="cursor:pointer">24h Vol/Market Cap</th>
                </tr>
            </thead>
            <tbody>
                <!-- 表格数据将被动态填充 -->
            </tbody>
        </table>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const apiURL = 'https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=volume_desc';
            let currenciesData = [];
            let sortConfig = { key: null, asc: true };

            function renderTable(data) {
                const tableBody = document.querySelector('#currencies-table tbody');
                tableBody.innerHTML = '';
                data.forEach(currency => {
                    const row = tableBody.insertRow();

                    const nameCell = row.insertCell();
                    const icon = document.createElement('img');
                    icon.src = `${currency.image}`;
                    icon.alt = `${currency.name}`;
                    icon.style.width = '20px';
                    icon.style.height = '20px';
                    icon.style.marginRight = '5px';
                    nameCell.appendChild(icon);
                    nameCell.appendChild(document.createTextNode(`${currency.symbol.toUpperCase()}`));

                    const priceCell = row.insertCell();
                    priceCell.textContent = `${formatNumber(currency.current_price)}`;

                    const changeCell = row.insertCell();
                    changeCell.textContent = `${formatNumber(currency.price_change_percentage_24h)}%`;

                    const volumeCell = row.insertCell();
                    volumeCell.textContent = `${formatVolume(currency.total_volume)}`;

                    const marketCapCell = row.insertCell();
                    marketCapCell.textContent = currency.market_cap ? formatVolume(currency.market_cap) : '-';

                    const ratioCell = row.insertCell();
                    if (currency.market_cap && currency.market_cap > 0) {
                        const ratio = currency.total_volume / currency.market_cap;
                        ratioCell.textContent = (ratio * 100).toFixed(2) + '%';
                    } else {
                        ratioCell.textContent = '-';
                    }
                });
            }

            fetch(apiURL)
                .then(response => response.json())
                .then(data => {
                    currenciesData = data;
                    renderTable(currenciesData);
                })
                .catch(error => console.error('Error:', error));

            function sortTable(key, isRatio = false) {
                if (sortConfig.key === key) {
                    sortConfig.asc = !sortConfig.asc;
                } else {
                    sortConfig.key = key;
                    sortConfig.asc = true;
                }
                let sorted = currenciesData.slice();
                sorted.sort((a, b) => {
                    let valA, valB;
                    if (isRatio) {
                        valA = a.market_cap && a.market_cap > 0 ? a.total_volume / a.market_cap : -Infinity;
                        valB = b.market_cap && b.market_cap > 0 ? b.total_volume / b.market_cap : -Infinity;
                    } else {
                        valA = a[key] !== undefined && a[key] !== null ? a[key] : -Infinity;
                        valB = b[key] !== undefined && b[key] !== null ? b[key] : -Infinity;
                    }
                    return sortConfig.asc ? valA - valB : valB - valA;
                });
                renderTable(sorted);
                updateSortIndicators();
            }

            function updateSortIndicators() {
                const ths = [
                    { id: 'th-price', key: 'current_price' },
                    { id: 'th-change', key: 'price_change_percentage_24h' },
                    { id: 'th-volume', key: 'total_volume' },
                    { id: 'th-marketcap', key: 'market_cap' },
                    { id: 'th-ratio', key: 'ratio' }
                ];
                ths.forEach(th => {
                    const el = document.getElementById(th.id);
                    if (!el) return;
                    let text = el.textContent.replace(/[↑↓]/g, '');
                    if ((sortConfig.key === th.key) || (th.key === 'ratio' && sortConfig.key === 'ratio')) {
                        text += sortConfig.asc ? ' ↑' : ' ↓';
                    }
                    el.textContent = text;
                });
            }

            document.getElementById('th-price').onclick = () => sortTable('current_price');
            document.getElementById('th-change').onclick = () => sortTable('price_change_percentage_24h');
            document.getElementById('th-volume').onclick = () => sortTable('total_volume');
            document.getElementById('th-marketcap').onclick = () => sortTable('market_cap');
            document.getElementById('th-ratio').onclick = () => sortTable('ratio', true);
        })

        function formatVolume(number) {
            if (number < 1e6) {
                return number.toLocaleString();
            } else {
                return `${(number / 1e6).toFixed(2)}M`;
            }
        }

        function formatNumber(number) {
            return number.toFixed(2);
        }
    </script>
    <div style='display:none'> 
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-G7B9G41KET"></script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-G7B9G41KET');   
    </div>
<link rel="alternate" hreflang="en" href="http://example.com/en/index.html">
<link rel="alternate" hreflang="zh" href="http://example.com/zh/index.html">
<link rel="alternate" hreflang="es" href="http://example.com/es/index.html">
<link rel="alternate" hreflang="fr" href="http://example.com/fr/index.html">
<link rel="alternate" hreflang="de" href="http://example.com/de/index.html">
<link rel="alternate" hreflang="ja" href="http://example.com/ja/index.html">
<link rel="alternate" hreflang="ko" href="http://example.com/ko/index.html">
<link rel="alternate" hreflang="ru" href="http://example.com/ru/index.html">
</body>
</html>
